# cnmx_ansible
## Условия перед запуском
Виртуальные машины под управлением CentOS Linux 7.
В системах существует пользователь user, пользователь досбавлен в группу wheel, пароль пользователя известен, настроен вход с использованием ключа ssh.
Если используется пользователь с другим именем, то имя нуобходимо указать в переменной *ansible_ssh_user* в inventories/{dev,stage,prod}/group_vars/all.yml

## Описание 
Настройка осуществляется тремя ролями: common, zookeeper, kafka.
Роль common устанавливает openjdk и выключает firewalld(подразумевается что все хосты находятся в безоасном периметре).
Роли zookeeper и kafka создают в системе пользователя, создают директории, устанавливают права на директории, скачивают и распаковывают дистрибутиывы программ, копируют, измененные по шаблону, конфигурационные файлы соответствующих программ, создание скрипта запуска, запускают сервис.

## Добавление хостов в инвентарь
Добавить хост в соответствующую группу (*zookeeper_hosts*, *kafka_hosts*) в inventories/{dev,stage,prod}/hosts
Установить перменные brocker_id для kafka хоста, zookeeper_myid для zookeeper хоста в inventories/{dev,stage,prod}/host_vars/*host*.yml
## Запуск
ANSIBLE_HOST_KEY_CHECKING=False ansible-playbook -i inventories/dev zookeeper.yum kafka.yml -K

ANSIBLE_HOST_KEY_CHECKING - позволяет игнорировать проверку подлинности SSH(подразумевается что работы проводятся в доверенном периметре)
-K - запрашивает пароль пользователя для повышения полномочий

После запуска ввести пароль пользователя user, необходимый для повышения полномочий в системе.